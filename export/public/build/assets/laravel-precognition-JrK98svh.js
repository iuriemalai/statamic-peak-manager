import{a as k,i as z,b as G,m as ee}from"./axios-CjxB0R_e.js";import{m as O,d as te,s as re,g as H,i as ne,o as N}from"./lodash-es-DzrphU2f.js";let C=k.create(),_=(e,n)=>`${e.method}:${e.baseURL??n.defaults.baseURL??""}${e.url}`,I=e=>e.status===204&&e.headers["precognition-success"]==="true";const w={},g={get:(e,n={},o={})=>P(S("get",e,n,o)),post:(e,n={},o={})=>P(S("post",e,n,o)),patch:(e,n={},o={})=>P(S("patch",e,n,o)),put:(e,n={},o={})=>P(S("put",e,n,o)),delete:(e,n={},o={})=>P(S("delete",e,n,o)),use(e){return C=e,g},axios(){return C},fingerprintRequestsUsing(e){return _=e===null?()=>null:e,g},determineSuccessUsing(e){return I=e,g}},S=(e,n,o,a)=>({url:n,method:e,...a,...["get","delete"].includes(e)?{params:O({},o,a?.params)}:{data:O({},o,a?.data)}}),P=(e={})=>{const n=[oe,ie,ae].reduce((o,a)=>a(o),e);return(n.onBefore??(()=>!0))()===!1?Promise.resolve(null):((n.onStart??(()=>null))(),C.request(n).then(async o=>{n.precognitive&&$(o);const a=o.status;let l=o;return n.precognitive&&n.onPrecognitionSuccess&&I(l)&&(l=await Promise.resolve(n.onPrecognitionSuccess(l)??l)),n.onSuccess&&se(a)&&(l=await Promise.resolve(n.onSuccess(l)??l)),(M(n,a)??(d=>d))(l)??l},o=>le(o)?Promise.reject(o):(n.precognitive&&$(o.response),(M(n,o.response.status)??((l,y)=>Promise.reject(y)))(o.response,o))).finally(n.onFinish??(()=>null)))},oe=e=>{const n=e.only??e.validate;return{...e,timeout:e.timeout??C.defaults.timeout??3e4,precognitive:e.precognitive!==!1,fingerprint:typeof e.fingerprint>"u"?_(e,C):e.fingerprint,headers:{...e.headers,"Content-Type":ue(e),...e.precognitive!==!1?{Precognition:!0}:{},...n?{"Precognition-Validate-Only":Array.from(n).join()}:{}}}},se=e=>e>=200&&e<300,ie=e=>(typeof e.fingerprint!="string"||(w[e.fingerprint]?.abort(),delete w[e.fingerprint]),e),ae=e=>typeof e.fingerprint!="string"||e.signal||e.cancelToken||!e.precognitive?e:(w[e.fingerprint]=new AbortController,{...e,signal:w[e.fingerprint].signal}),$=e=>{if(e.headers?.precognition!=="true")throw Error("Did not receive a Precognition response. Ensure you have the Precognition middleware in place for the route.")},le=e=>!G(e)||typeof e.response?.status!="number"||z(e),M=(e,n)=>({401:e.onUnauthorized,403:e.onForbidden,404:e.onNotFound,409:e.onConflict,422:e.onValidationError,423:e.onLocked})[n],ue=e=>e.headers?.["Content-Type"]??e.headers?.["Content-type"]??e.headers?.["content-type"]??(J(e.data)?"multipart/form-data":"application/json"),J=e=>D(e)||typeof e=="object"&&e!==null&&Object.values(e).some(n=>J(n)),D=e=>typeof File<"u"&&e instanceof File||e instanceof Blob||typeof FileList<"u"&&e instanceof FileList&&e.length>0,pe=e=>typeof e=="string"?e:e(),he=e=>typeof e=="string"?e.toLowerCase():e(),ge=(e,n={})=>{const o={errorsChanged:[],touchedChanged:[],validatingChanged:[],validatedChanged:[]};let a=!1,l=!1;const y=t=>t!==l?(l=t,o.validatingChanged):[];let d=[];const A=t=>{const r=[...new Set(t)];return d.length!==r.length||!r.every(s=>d.includes(s))?(d=r,o.validatedChanged):[]},K=()=>d.filter(t=>typeof p[t]>"u");let c=[];const E=t=>{const r=[...new Set(t)];return c.length!==r.length||!r.every(s=>c.includes(s))?(c=r,o.touchedChanged):[]};let p={};const F=t=>{const r=ce(t);return ne(p,r)?[]:(p=r,o.errorsChanged)},Q=t=>{const r={...p};return delete r[q(t)],F(r)},W=()=>Object.keys(p).length>0;let L=1500;const X=t=>{L=t,V.cancel(),V=x()};let j=n,T=null,U=[],R=null;const x=()=>te(t=>{e({get:(r,s={},i={})=>g.get(r,m(s),b(i,t,s)),post:(r,s={},i={})=>g.post(r,m(s),b(i,t,s)),patch:(r,s={},i={})=>g.patch(r,m(s),b(i,t,s)),put:(r,s={},i={})=>g.put(r,m(s),b(i,t,s)),delete:(r,s={},i={})=>g.delete(r,m(s),b(i,t,s))}).catch(r=>z(r)||G(r)&&r.response?.status===422?null:Promise.reject(r))},L,{leading:!0,trailing:!0});let V=x();const b=(t,r,s={})=>{const i={...t,...r},h=Array.from(i.only??i.validate??c);return{...r,...ee(t,r),only:h,timeout:i.timeout??5e3,onValidationError:(u,v)=>([...A([...d,...h]),...F(O(N({...p},h),u.data.errors))].forEach(Z=>Z()),i.onValidationError?i.onValidationError(u,v):Promise.reject(v)),onSuccess:u=>(A([...d,...h]).forEach(v=>v()),i.onSuccess?i.onSuccess(u):u),onPrecognitionSuccess:u=>([...A([...d,...h]),...F(N({...p},h))].forEach(v=>v()),i.onPrecognitionSuccess?i.onPrecognitionSuccess(u):u),onBefore:()=>i.onBeforeValidation&&i.onBeforeValidation({data:s,touched:c},{data:j,touched:U})===!1||(i.onBefore||(()=>!0))()===!1?!1:(R=c,T=s,!0),onStart:()=>{y(!0).forEach(u=>u()),(i.onStart??(()=>null))()},onFinish:()=>{y(!1).forEach(u=>u()),U=R,j=T,R=T=null,(i.onFinish??(()=>null))()}}},Y=(t,r,s)=>{if(typeof t>"u"){const i=Array.from(s?.only??s?.validate??[]);E([...c,...i]).forEach(h=>h()),V(s??{});return}if(D(r)&&!a){console.warn('Precognition file validation is not active. Call the "validateFiles" function on your form to enable it.');return}t=q(t),H(j,t)!==r&&(E([t,...c]).forEach(i=>i()),V(s??{}))},m=t=>a===!1?B(t):t,f={touched:()=>c,validate(t,r,s){return typeof t=="object"&&!("target"in t)&&(s=t,t=r=void 0),Y(t,r,s),f},touch(t){const r=Array.isArray(t)?t:[q(t)];return E([...c,...r]).forEach(s=>s()),f},validating:()=>l,valid:K,errors:()=>p,hasErrors:W,setErrors(t){return F(t).forEach(r=>r()),f},forgetError(t){return Q(t).forEach(r=>r()),f},reset(...t){if(t.length===0)E([]).forEach(r=>r());else{const r=[...c];t.forEach(s=>{r.includes(s)&&r.splice(r.indexOf(s),1),re(j,s,H(n,s))}),E(r).forEach(s=>s())}return f},setTimeout(t){return X(t),f},on(t,r){return o[t].push(r),f},validateFiles(){return a=!0,f}};return f},ve=e=>Object.keys(e).reduce((n,o)=>({...n,[o]:Array.isArray(e[o])?e[o][0]:e[o]}),{}),ce=e=>Object.keys(e).reduce((n,o)=>({...n,[o]:typeof e[o]=="string"?[e[o]]:e[o]}),{}),q=e=>typeof e!="string"?e.target.name:e,B=e=>{const n={...e};return Object.keys(n).forEach(o=>{const a=n[o];if(a!==null){if(D(a)){delete n[o];return}if(Array.isArray(a)){n[o]=Object.values(B({...a}));return}if(typeof a=="object"){n[o]=B(n[o]);return}}}),n};export{he as a,g as b,ge as c,q as d,pe as r,ve as t};
